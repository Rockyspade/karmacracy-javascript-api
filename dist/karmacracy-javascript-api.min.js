/*! karmacracy-javascript-api - v0.1.0 - 2014-12-09
* http://jorgecasar.github.io/karmacracy-javascript-api/
* Copyright (c) 2014 Jorge del Casar; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.Karmacracy=b()}(this,function(){"use strict";function a(a,b){var c=a,d="http://karmacracy.com/api/v1/",e=["en","es"],f=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&("[object Object]"!==Object.prototype.toString.call(a[c])?a[c]&&b.push(c+"="+a[c]):b.push(a[c].serialize()));return b.join("&")},g=function(a,b,c,d){"function"==typeof b&&(d=c||null,c=b,b={});var e=XMLHttpRequest?new XMLHttpRequest({mozSystem:!0}):new ActiveXObject("Microsoft.XMLHTTP"),f=h.call(this),g=j.call(this,a,b);e.open(f,g,!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var b=i(a,e);b&&"function"==typeof d&&d(b)}},e.onerror=c,e.send()},h=function(){return"GET"},i=function(a,b){var c=JSON.parse(b.responseText);if(c.error)return b.onerror(c);switch(c.data&&(c=c.data),a){case"user":c=c.user[0];break;case"awards":case"awards:nut":c=c.nut;break;case"networks":c=c.network;break;case"domains":c=c.domain;break;case"kcy":case"world":c=c.kcy;break;case"rank":c=c.user;break;case"stats:evolution":c=c.stats,c.links_evolution=JSON.parse(c.links_evolution),c.koi_evolution=JSON.parse(c.koi_evolution),c.clicks_evolution=JSON.parse(c.clicks_evolution),c.rank_evolution=JSON.parse(c.rank_evolution);break;case"stats:relevance":c=c.stats;break;case"firewords":c=c.word}return c},j=function(a,b){var e=d;switch(b=b||{},b.u=b.u||this.userName,b.k=b.k||this.userKey,b.appkey=c,a){case"key":e+=a+"/",delete b.k,b.p=encodeURIComponent(b.p),b=f(b),""!==b&&(e+="?"+b);break;case"key:check":a=a.replace(":","/"),e+=a+"/",b.key=b.k,delete b.k,b=f(b),""!==b&&(e+="?"+b);break;case"user":case"awards":e+=[a,b.u].join("/"),delete b.u,b=f(b),""!==b&&(e+="?"+b);break;case"awards:nut":if(!b.n)return!1;a=a.split(":"),e+=[a[0],b.u,a[1],b.n].join("/"),b.lang=this.lang,delete b.u,delete b.n,b=f(b),""!==b&&(e+="?"+b);break;case"networks:fbpages":a=a.replace(":","/"),e+=a+"/",b=f(b),""!==b&&(e+="?"+b);break;case"stats:evolution":case"stats:relevance":a=a.replace(":","/"),e+=a+"/",delete b.k,b=f(b),""!==b&&(e+="?"+b);break;case"kcy":case"world":e+=[a,b.kcy].join("/"),delete b.kcy,delete b.u,delete b.k,b=f(b),""!==b&&(e+="?"+b);break;case"networks":case"domains":case"rank":e+=a+"/",b=f(b),""!==b&&(e+="?"+b);break;case"share":e+=a+"/",b.txt=encodeURIComponent(b.txt),b=f(b),""!==b&&(e+="?"+b);break;case"shortLink":e="http://kcy.me/api/",b.format="json",b.key=b.k,b.url=encodeURIComponent(b.url),delete b.k,b=f(b),""!==b&&(e+="?"+b);break;case"firewords":e+=a+"/",b.format="json",b=f(b),""!==b&&(e+="?"+b)}return e};this.setLang=function(a){return this.lang=a||("undefined"!=typeof navigator?navigator.language||navigator.userLanguage:null),-1===e.indexOf(this.lang)&&(this.lang=e[0]),this.lang},this.setUserKey=function(a){return this.userKey=a,this.userKey},this.setUserName=function(a){return this.userName=a,this.userName},this.setUser=function(a,b){this.setUserName(a),this.setUserKey(b)},this.getKey=function(a,b,c){var d="key";a.regenerate=0,g.call(this,d,a,b,c)},this.getNewKey=function(a,b,c){var d="key";a.regenerate=1,g.call(this,d,a,b,c)},this.checkKey=function(a,b,c){var d="key:check";g.call(this,d,a,b,c)},this.getUserInfo=function(a,b,c){var d="user";g.call(this,d,a,b,c)},this.getNuts=function(a,b,c){var d="awards";g.call(this,d,a,b,c)},this.getNut=function(a,b,c){var d="awards:nut";g.call(this,d,a,b,c)},this.getNetworks=function(a,b){var c="networks";g.call(this,c,a,b)},this.getFacebookPages=function(a,b,c){var d="networks:fbpages";g.call(this,d,a,b,c)},this.getDomains=function(a,b,c){var d="domains";g.call(this,d,a,b,c)},this.getKcy=function(a,b,c){var d="kcy";g.call(this,d,a,b,c)},this.getKcys=function(a,b,c){var d="world";g.call(this,d,a,b,c)},this.getRank=function(a,b,c){var d="rank";g.call(this,d,a,b,c)},this.getStatsEvolution=function(a,b,c){var d="stats:evolution";g.call(this,d,a,b,c)},this.getStatsRelevance=function(a,b,c){var d="stats:relevance";g.call(this,d,a,b,c)},this.shortLink=function(a,b,c){var d="shortLink";g.call(this,d,a,b,c)},this.shareKcy=function(a,b,c){var d="share";g.call(this,d,a,b,c)},this.getFirewords=function(a,b,c){var d="firewords";g.call(this,d,a,b,c)},this.setLang(b)}return a});