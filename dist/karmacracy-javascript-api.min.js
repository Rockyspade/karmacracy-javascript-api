/*! karmacracy-javascript-api - v0.1.0 - 2014-12-09
* http://jorgecasar.github.io/karmacracy-javascript-api/
* Copyright (c) 2014 Jorge del Casar; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["XMLHttpRequest"],b):"object"==typeof exports?module.exports=b(require("xmlhttprequest").XMLHttpRequest):a.Karmacracy=b(XMLHttpRequest)}(this,function(a){"use strict";function b(b,c){var d=b,e="http://karmacracy.com/api/v1/",f=["en","es"],g=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&("[object Object]"!==Object.prototype.toString.call(a[c])?a[c]&&b.push(c+"="+a[c]):b.push(a[c].serialize()));return b.join("&")},h=function(b,c,d){"function"==typeof c&&(d=c,c={});var e=a?new a({mozSystem:!0}):new ActiveXObject("Microsoft.XMLHTTP"),f=i.call(this),g=k.call(this,b,c);e.open(f,g,!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a=j(b,e);a&&"function"==typeof d&&d(null,a)}},e.onerror=function(a){d(a,null)},e.send()},i=function(){return"GET"},j=function(a,b){var c;try{c=JSON.parse(b.responseText)}catch(d){return b.onerror(d,null)}if(c.error)return b.onerror(c,null);switch(c.data&&(c=c.data),a){case"user":c=c.user[0];break;case"awards":case"awards:nut":c=c.nut;break;case"networks":c=c.network;break;case"domains":c=c.domain;break;case"kcy":case"world":c=c.kcy;break;case"rank":c=c.user;break;case"stats:evolution":c=c.stats,c.links_evolution=c.links_evolution?JSON.parse(c.links_evolution):{},c.koi_evolution=c.koi_evolution?JSON.parse(c.koi_evolution):{},c.clicks_evolution=c.clicks_evolution?JSON.parse(c.clicks_evolution):{},c.rank_evolution=c.rank_evolution?JSON.parse(c.rank_evolution):{};break;case"stats:relevance":c=c.stats;break;case"firewords":c=c.word}return c},k=function(a,b){var c=e;switch(b=b||{},b.u=b.u||this.userName,b.k=b.k||this.userKey,b.appkey=d,a){case"key":c+=a+"/",delete b.k,b.p=encodeURIComponent(b.p),b=g(b),""!==b&&(c+="?"+b);break;case"key:check":a=a.replace(":","/"),c+=a+"/",b.key=b.k,delete b.k,b=g(b),""!==b&&(c+="?"+b);break;case"user":case"awards":c+=[a,b.u].join("/"),delete b.u,b=g(b),""!==b&&(c+="?"+b);break;case"awards:nut":if(!b.n)return!1;a=a.split(":"),c+=[a[0],b.u,a[1],b.n].join("/"),b.lang=this.lang,delete b.u,delete b.n,b=g(b),""!==b&&(c+="?"+b);break;case"networks:fbpages":a=a.replace(":","/"),c+=a+"/",b=g(b),""!==b&&(c+="?"+b);break;case"stats:evolution":case"stats:relevance":a=a.replace(":","/"),c+=a+"/",delete b.k,b=g(b),""!==b&&(c+="?"+b);break;case"kcy":case"world":c+=[a,b.kcy].join("/"),delete b.kcy,delete b.u,delete b.k,b=g(b),""!==b&&(c+="?"+b);break;case"networks":case"domains":case"rank":c+=a+"/",b=g(b),""!==b&&(c+="?"+b);break;case"share":c+=a+"/",b.txt=encodeURIComponent(b.txt),b=g(b),""!==b&&(c+="?"+b);break;case"shortLink":c="http://kcy.me/api/",b.format="json",b.key=b.k,b.url=encodeURIComponent(b.url),delete b.k,b=g(b),""!==b&&(c+="?"+b);break;case"firewords":c+=a+"/",b.format="json",b=g(b),""!==b&&(c+="?"+b)}return c};this.setLang=function(a){return this.lang=a||("undefined"!=typeof navigator?navigator.language||navigator.userLanguage:null),-1===f.indexOf(this.lang)&&(this.lang=f[0]),this.lang},this.setUserKey=function(a){return this.userKey=a,this.userKey},this.setUserName=function(a){return this.userName=a,this.userName},this.setUser=function(a,b){this.setUserName(a),this.setUserKey(b)},this.getKey=function(a,b){var c="key";a.regenerate=0,h.call(this,c,a,b)},this.getNewKey=function(a,b){var c="key";a.regenerate=1,h.call(this,c,a,b)},this.checkKey=function(a,b){var c="key:check";h.call(this,c,a,b)},this.getUserInfo=function(a,b){var c="user";h.call(this,c,a,b)},this.getNuts=function(a,b){var c="awards";h.call(this,c,a,b)},this.getNut=function(a,b){var c="awards:nut";h.call(this,c,a,b)},this.getNetworks=function(a){var b="networks";h.call(this,b,a)},this.getFacebookPages=function(a,b){var c="networks:fbpages";h.call(this,c,a,b)},this.getDomains=function(a,b){var c="domains";h.call(this,c,a,b)},this.getKcy=function(a,b){var c="kcy";h.call(this,c,a,b)},this.getKcys=function(a,b){var c="world";h.call(this,c,a,b)},this.getRank=function(a,b){var c="rank";h.call(this,c,a,b)},this.getStatsEvolution=function(a,b){var c="stats:evolution";h.call(this,c,a,b)},this.getStatsRelevance=function(a,b){var c="stats:relevance";h.call(this,c,a,b)},this.shortLink=function(a,b){var c="shortLink";h.call(this,c,a,b)},this.shareKcy=function(a,b){var c="share";h.call(this,c,a,b)},this.getFirewords=function(a,b){var c="firewords";h.call(this,c,a,b)},this.setLang(c)}return b});